# Story 2.3: Delete a Context Profile

## Status

Draft

## Story

**As a** developer using contextr,
**I want** to delete saved profiles that I no longer need,
**so that** I can keep my profile list clean and remove outdated configurations.

## Acceptance Criteria

1. `ctxr profile delete <name>` command implemented
2. Confirmation prompt before deletion
3. Clear error for non-existent profiles
4. Profile removed from filesystem
5. Unit tests for deletion logic

## Tasks / Subtasks

- [ ] Implement delete_profile in ProfileManager (AC: 1, 3, 4)
  - [ ] Add delete_profile method to remove profile by name
  - [ ] Check profile exists before attempting deletion
  - [ ] Use storage backend delete operation
  - [ ] Raise ProfileNotFoundError for missing profiles
  - [ ] Ensure complete removal from filesystem
- [ ] Add delete CLI command (AC: 1, 2)
  - [ ] Add delete command to profile command group
  - [ ] Accept profile name as required argument
  - [ ] Implement confirmation prompt with typer.confirm
  - [ ] Add --force flag to skip confirmation
  - [ ] Display success message after deletion
- [ ] Implement safety checks (AC: 2, 3)
  - [ ] Show profile details before deletion prompt
  - [ ] Clear confirmation message: "Delete profile '{name}'?"
  - [ ] Handle user abort gracefully
  - [ ] Provide helpful error for non-existent profiles
- [ ] Write comprehensive unit tests (AC: 5)
  - [ ] Test delete_profile with existing profile
  - [ ] Test delete with non-existent profile
  - [ ] Test confirmation prompt behavior
  - [ ] Test --force flag bypasses confirmation
  - [ ] Test abort on "no" confirmation
  - [ ] Verify filesystem cleanup
  - [ ] Mock storage operations for unit tests

## Dev Notes

### Architecture Context

**ProfileManager delete_profile Method** [Source: epic-2-implementation-guide.md#technical-design]
```python
def delete_profile(self, name: str) -> bool:
    """Delete a profile by name"""
    key = f"{self.profile_prefix}/{name}"
    if not self.storage.exists(key):
        raise ProfileNotFoundError(f"Profile '{name}' not found")
    return self.storage.delete(key)
```

**CLI Delete Command** [Source: epic-2-implementation-guide.md#cli-command]
```python
@profile.command("delete")
def delete_profile(
    name: str = typer.Argument(..., help="Profile name to delete"),
    force: bool = typer.Option(False, "--force", "-f", help="Skip confirmation")
):
    """Delete a saved profile"""
    if not force:
        confirm = typer.confirm(f"Delete profile '{name}'?")
        if not confirm:
            raise typer.Abort()
```

**Storage Backend Interface** [Source: architecture.md#storage-architecture]
- Storage backend already has delete() method from base class
- JsonStorage implements atomic delete operations
- Returns boolean indicating success
- File removal should be immediate and complete

**Error Handling** [Source: epic-2-implementation-guide.md#error-handling]
- ProfileNotFoundError with message: "Profile '{name}' not found. Use 'ctxr profile list' to see available profiles."
- typer.Abort() for cancelled operations
- Exit code 1 for errors

**Previous Story Insights**:
- ProfileManager established with storage operations
- Profile command group structure in place
- Error handling patterns established
- Storage uses "profiles/{name}" key format

**File Locations Based on Project Structure**:
- delete_profile method: Add to `src/contextr/profile.py`
- Delete command: Add to profile command group in `src/contextr/cli.py`
- Tests: Add to `tests/unit/test_profile.py`

### Testing Requirements

**Testing Standards** [Source: prd.md#testing-strategy]
- Test both interactive and non-interactive (--force) modes
- Verify actual file deletion from filesystem
- Test user experience flows (confirm/abort)
- Mock typer.confirm for unit tests

**Test Scenarios from Implementation Guide** [Source: epic-2-implementation-guide.md#test-cases]
- Delete existing profile with confirmation
- Delete with --force flag
- Abort deletion on "no" confirmation
- Error on non-existent profile
- Verify filesystem cleanup

### Technical Constraints

- Deletion must be atomic - either complete or fail [Source: architecture.md#design-principles]
- No orphaned files should remain after deletion
- Confirmation prompt must be clear and unambiguous
- --force flag standard for CLI tools

### Performance Requirements

- Delete operations <100ms [Source: prd.md#performance]
- No unnecessary file system scans
- Direct profile removal without loading content

## Change Log

| Date       | Version | Description                        | Author    |
|------------|---------|-----------------------------------|-----------|
| 2025-07-25 | 1.0     | Initial story creation            | Bob (SM)  |

## Dev Agent Record

### Agent Model Used

_To be populated by development agent_

### Debug Log References

_To be populated by development agent_

### Completion Notes List

_To be populated by development agent_

### File List

_To be populated by development agent_

## QA Results

_To be populated by QA agent_