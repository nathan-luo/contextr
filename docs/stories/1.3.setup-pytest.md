# Story 1.3: Set Up Pytest Framework

## Status
Draft

## Story
**As a** developer,  
**I want** the pytest framework set up,  
**so that** I can write and run automated tests for the application.

## Acceptance Criteria
1. pytest is added as a development dependency.
2. A `tests/` directory is created.
3. pytest can be executed successfully and discovers tests within the `tests/` directory.
4. A simple unit test is created for a utility function (e.g., in `path_utils.py`) that passes when pytest is run.

## Tasks / Subtasks
- [ ] Add pytest and related dependencies (AC: 1)
  - [ ] Add pytest to pyproject.toml dev dependencies
  - [ ] Add pytest-cov for coverage reporting
  - [ ] Add pytest-mock for mocking support
  - [ ] Install updated dependencies
- [ ] Create test directory structure (AC: 2)
  - [ ] Create tests/ directory at project root
  - [ ] Create tests/__init__.py
  - [ ] Create tests/unit/ subdirectory
  - [ ] Create tests/integration/ subdirectory
  - [ ] Create tests/fixtures/ for test data
  - [ ] Add conftest.py for shared fixtures
- [ ] Configure pytest (AC: 3)
  - [ ] Add [tool.pytest.ini_options] to pyproject.toml
  - [ ] Configure test paths and discovery patterns
  - [ ] Set up coverage reporting options
  - [ ] Verify pytest discovers test directories
- [ ] Create initial unit test (AC: 4)
  - [ ] Create tests/unit/utils/test_path_utils.py
  - [ ] Write test for get_relative_path function
  - [ ] Write test for find_git_root function
  - [ ] Ensure tests pass with meaningful assertions
- [ ] Document testing setup
  - [ ] Update CLAUDE.md with pytest commands
  - [ ] Add testing guidelines
  - [ ] Document coverage goals

## Dev Notes

### Test Directory Structure
```
tests/
├── __init__.py
├── conftest.py           # Shared fixtures
├── unit/                 # Unit tests
│   ├── __init__.py
│   ├── test_cli.py
│   ├── test_manager.py
│   ├── test_formatters.py
│   └── utils/
│       ├── __init__.py
│       ├── test_path_utils.py
│       └── test_ignore_utils.py
├── integration/          # Integration tests
│   ├── __init__.py
│   └── test_commands.py
└── fixtures/            # Test data
    └── sample_project/
```

### Testing Strategy
- Unit tests for individual functions/methods
- Integration tests for CLI commands
- Mock file system operations where appropriate
- Use fixtures for common test data
- Aim for 80% code coverage initially

### Example Test Pattern
```python
import pytest
from pathlib import Path
from contextr.utils.path_utils import get_relative_path, find_git_root

def test_get_relative_path():
    """Test relative path calculation."""
    base = Path("/home/user/project")
    target = Path("/home/user/project/src/file.py")
    result = get_relative_path(target, base)
    assert result == Path("src/file.py")

def test_find_git_root(tmp_path):
    """Test git root discovery."""
    # Create mock git structure
    git_dir = tmp_path / ".git"
    git_dir.mkdir()
    
    # Test from subdirectory
    subdir = tmp_path / "src" / "utils"
    subdir.mkdir(parents=True)
    
    result = find_git_root(subdir)
    assert result == tmp_path
```

### Coverage Configuration
```toml
[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = ["test_*.py", "*_test.py"]
addopts = "--cov=contextr --cov-report=html --cov-report=term"
```

### Testing Standards
- Write tests before fixing bugs
- Each new feature needs tests
- Mock external dependencies
- Use descriptive test names
- Group related tests in classes
- Use parametrize for multiple test cases

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-07-23 | 1.0 | Initial story creation | BMad Master |

## Dev Agent Record
### Agent Model Used
(To be filled by dev agent)

### Debug Log References
(To be filled by dev agent)

### Completion Notes List
(To be filled by dev agent)

### File List
(To be filled by dev agent)

## QA Results
(To be filled by QA agent)